(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[626],{1816:function(e,t,n){Promise.resolve().then(n.bind(n,5024))},5024:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return c}});var r=n(7573),s=n(7653),i=n(1695),a=n(3400),o=n(5118),l=n(8144),u=n(3212);function c(){let e=(0,i.useRouter)(),t=(0,l.t)(e=>e.login),[n,c]=(0,s.useState)("phone"),[d,E]=(0,s.useState)(""),[f,S]=(0,s.useState)(""),[h,N]=(0,s.useState)(!1),[O,R]=(0,s.useState)(""),I=async()=>{N(!0),R("");try{await (0,o.S)("/auth/otp/send",{method:"POST",body:JSON.stringify({phone:d})}),c("otp")}catch(e){R("인증번호 발송에 실패했습니다")}finally{N(!1)}},m=async()=>{N(!0),R("");try{let n=await (0,o.S)("/auth/otp/verify",{method:"POST",body:JSON.stringify({phone:d,code:f})});if(n.user.role!==u.UserRole.SITE_ADMIN&&n.user.role!==u.UserRole.SUPER_ADMIN){R("관리자 권한이 없습니다");return}t(n.user,n.tokens),e.push("/dashboard")}catch(e){R("인증번호가 올바르지 않습니다")}finally{N(!1)}};return(0,r.jsx)("div",{className:"flex min-h-screen items-center justify-center bg-slate-100 p-4",children:(0,r.jsxs)(a.Zb,{className:"w-full max-w-md p-8",children:[(0,r.jsxs)("div",{className:"mb-8 text-center",children:[(0,r.jsx)("h1",{className:"text-2xl font-bold",children:"안전지갑 관리자"}),(0,r.jsx)("p",{className:"mt-2 text-muted-foreground",children:"관리자 계정으로 로그인하세요"})]}),"phone"===n?(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"mb-2 block text-sm font-medium",children:"휴대폰 번호"}),(0,r.jsx)(a.II,{type:"tel",placeholder:"010-0000-0000",value:d,onChange:e=>E(e.target.value),disabled:h})]}),O&&(0,r.jsx)("p",{className:"text-sm text-destructive",children:O}),(0,r.jsx)(a.zx,{className:"w-full",onClick:I,disabled:!d||h,children:h?"발송 중...":"인증번호 받기"})]}):(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"mb-2 block text-sm font-medium",children:"인증번호"}),(0,r.jsx)(a.II,{type:"text",placeholder:"6자리 인증번호",value:f,onChange:e=>S(e.target.value),disabled:h,maxLength:6})]}),O&&(0,r.jsx)("p",{className:"text-sm text-destructive",children:O}),(0,r.jsx)(a.zx,{className:"w-full",onClick:m,disabled:6!==f.length||h,children:h?"확인 중...":"로그인"}),(0,r.jsx)(a.zx,{variant:"ghost",className:"w-full",onClick:()=>{c("phone"),S(""),R("")},children:"다른 번호로 시도"})]})]})})}},5118:function(e,t,n){"use strict";n.d(t,{S:function(){return a}});var r=n(8144);let s="https://safework2.jclee.me/api";class i extends Error{constructor(e,t,n){super(e),this.status=t,this.code=n,this.name="ApiError"}}async function a(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{tokens:n,logout:a,setTokens:o}=r.t.getState(),l={"Content-Type":"application/json",...t.headers||{}};(null==n?void 0:n.accessToken)&&(l.Authorization="Bearer ".concat(n.accessToken));let u=await fetch("".concat(s).concat(e),{...t,headers:l});if(401===u.status&&(null==n?void 0:n.refreshToken)){let r=await fetch("".concat(s,"/auth/refresh"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({refreshToken:n.refreshToken})});if(r.ok){let n=await r.json();o(n),l.Authorization="Bearer ".concat(n.accessToken),u=await fetch("".concat(s).concat(e),{...t,headers:l})}else throw a(),new i("Session expired",401,"SESSION_EXPIRED")}if(!u.ok){let e=await u.json().catch(()=>({}));throw new i(e.message||"Request failed",u.status,e.code)}return u.json()}},8144:function(e,t,n){"use strict";n.d(t,{t:function(){return a}});var r=n(8321),s=n(4452),i=n(3212);let a=(0,r.U)()((0,s.tJ)((e,t)=>({user:null,tokens:null,currentSiteId:null,isAdmin:!1,login:(t,n)=>e({user:t,tokens:n,isAdmin:t.role===i.UserRole.SITE_ADMIN||t.role===i.UserRole.SUPER_ADMIN}),logout:()=>e({user:null,tokens:null,currentSiteId:null,isAdmin:!1}),setTokens:t=>e({tokens:t}),setSiteId:t=>e({currentSiteId:t})}),{name:"safetywallet-admin-auth"}))},1695:function(e,t,n){"use strict";var r=n(1219);n.o(r,"useParams")&&n.d(t,{useParams:function(){return r.useParams}}),n.o(r,"usePathname")&&n.d(t,{usePathname:function(){return r.usePathname}}),n.o(r,"useRouter")&&n.d(t,{useRouter:function(){return r.useRouter}})},5363:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},8658:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},8536:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},4602:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},6183:function(e,t,n){"use strict";var r=Object.create?function(e,t,n,r){void 0===r&&(r=n);var s=Object.getOwnPropertyDescriptor(t,n);(!s||("get"in s?!t.__esModule:s.writable||s.configurable))&&(s={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,s)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]},s=function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||r(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),s(n(4602),t),s(n(3700),t),s(n(6668),t),s(n(5769),t),s(n(2232),t),s(n(1098),t),s(n(8658),t),s(n(8536),t)},1098:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},5769:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},2232:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},6668:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},3700:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},9633:function(e,t){"use strict";var n,r,s,i,a,o,l,u,c,d,E,f,S,h,N,O,R,I,m,v;Object.defineProperty(t,"__esModule",{value:!0}),t.RejectReason=t.TaskStatus=t.ReviewAction=t.ActionStatus=t.ReviewStatus=t.Visibility=t.RiskLevel=t.Category=t.MembershipStatus=t.UserRole=void 0,(E=n||(t.UserRole=n={})).WORKER="WORKER",E.SITE_ADMIN="SITE_ADMIN",E.SUPER_ADMIN="SUPER_ADMIN",E.SYSTEM="SYSTEM",(f=r||(t.MembershipStatus=r={})).PENDING="PENDING",f.ACTIVE="ACTIVE",f.LEFT="LEFT",f.REMOVED="REMOVED",(S=s||(t.Category=s={})).HAZARD="HAZARD",S.UNSAFE_BEHAVIOR="UNSAFE_BEHAVIOR",S.INCONVENIENCE="INCONVENIENCE",S.SUGGESTION="SUGGESTION",S.BEST_PRACTICE="BEST_PRACTICE",(h=i||(t.RiskLevel=i={})).HIGH="HIGH",h.MEDIUM="MEDIUM",h.LOW="LOW",(N=a||(t.Visibility=a={})).WORKER_PUBLIC="WORKER_PUBLIC",N.ADMIN_ONLY="ADMIN_ONLY",(O=o||(t.ReviewStatus=o={})).RECEIVED="RECEIVED",O.IN_REVIEW="IN_REVIEW",O.NEED_INFO="NEED_INFO",O.APPROVED="APPROVED",O.REJECTED="REJECTED",(R=l||(t.ActionStatus=l={})).NONE="NONE",R.REQUIRED="REQUIRED",R.ASSIGNED="ASSIGNED",R.IN_PROGRESS="IN_PROGRESS",R.DONE="DONE",R.REOPENED="REOPENED",(I=u||(t.ReviewAction=u={})).APPROVE="APPROVE",I.REJECT="REJECT",I.REQUEST_MORE="REQUEST_MORE",I.MARK_URGENT="MARK_URGENT",I.ASSIGN="ASSIGN",I.CLOSE="CLOSE",(m=c||(t.TaskStatus=c={})).OPEN="OPEN",m.IN_PROGRESS="IN_PROGRESS",m.DONE="DONE",(v=d||(t.RejectReason=d={})).DUPLICATE="DUPLICATE",v.UNCLEAR_PHOTO="UNCLEAR_PHOTO",v.INSUFFICIENT="INSUFFICIENT",v.FALSE="FALSE",v.IRRELEVANT="IRRELEVANT",v.OTHER="OTHER"},3212:function(e,t,n){"use strict";var r=Object.create?function(e,t,n,r){void 0===r&&(r=n);var s=Object.getOwnPropertyDescriptor(t,n);(!s||("get"in s?!t.__esModule:s.writable||s.configurable))&&(s={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,s)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]},s=function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||r(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),s(n(9633),t),s(n(5363),t),s(n(6183),t)},4452:function(e,t,n){"use strict";n.d(t,{tJ:function(){return s}});let r=e=>t=>{try{let n=e(t);if(n instanceof Promise)return n;return{then:e=>r(e)(n),catch(e){return this}}}catch(e){return{then(e){return this},catch:t=>r(t)(e)}}},s=(e,t)=>(n,s,i)=>{let a,o={storage:function(e,t){let n;try{n=e()}catch(e){return}return{getItem:e=>{var t;let r=e=>null===e?null:JSON.parse(e,void 0),s=null!=(t=n.getItem(e))?t:null;return s instanceof Promise?s.then(r):r(s)},setItem:(e,t)=>n.setItem(e,JSON.stringify(t,void 0)),removeItem:e=>n.removeItem(e)}}(()=>window.localStorage),partialize:e=>e,version:0,merge:(e,t)=>({...t,...e}),...t},l=!1,u=0,c=new Set,d=new Set,E=o.storage;if(!E)return e((...e)=>{console.warn(`[zustand persist middleware] Unable to update item '${o.name}', the given storage is currently unavailable.`),n(...e)},s,i);let f=()=>{let e=o.partialize({...s()});return E.setItem(o.name,{state:e,version:o.version})},S=i.setState;i.setState=(e,t)=>(S(e,t),f());let h=e((...e)=>(n(...e),f()),s,i);i.getInitialState=()=>h;let N=()=>{var e,t;if(!E)return;let i=++u;l=!1,c.forEach(e=>{var t;return e(null!=(t=s())?t:h)});let S=(null==(t=o.onRehydrateStorage)?void 0:t.call(o,null!=(e=s())?e:h))||void 0;return r(E.getItem.bind(E))(o.name).then(e=>{if(e){if("number"!=typeof e.version||e.version===o.version)return[!1,e.state];if(o.migrate){let t=o.migrate(e.state,e.version);return t instanceof Promise?t.then(e=>[!0,e]):[!0,t]}console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}return[!1,void 0]}).then(e=>{var t;if(i!==u)return;let[r,l]=e;if(n(a=o.merge(l,null!=(t=s())?t:h),!0),r)return f()}).then(()=>{i===u&&(null==S||S(a,void 0),a=s(),l=!0,d.forEach(e=>e(a)))}).catch(e=>{i===u&&(null==S||S(void 0,e))})};return i.persist={setOptions:e=>{o={...o,...e},e.storage&&(E=e.storage)},clearStorage:()=>{null==E||E.removeItem(o.name)},getOptions:()=>o,rehydrate:()=>N(),hasHydrated:()=>l,onHydrate:e=>(c.add(e),()=>{c.delete(e)}),onFinishHydration:e=>(d.add(e),()=>{d.delete(e)})},o.skipHydration||N(),a||h}},8321:function(e,t,n){"use strict";n.d(t,{U:function(){return l}});var r=n(7653);let s=e=>{let t;let n=new Set,r=(e,r)=>{let s="function"==typeof e?e(t):e;if(!Object.is(s,t)){let e=t;t=(null!=r?r:"object"!=typeof s||null===s)?s:Object.assign({},t,s),n.forEach(n=>n(t,e))}},s=()=>t,i={setState:r,getState:s,getInitialState:()=>a,subscribe:e=>(n.add(e),()=>n.delete(e))},a=t=e(r,s,i);return i},i=e=>e?s(e):s,a=e=>e,o=e=>{let t=i(e),n=e=>(function(e,t=a){let n=r.useSyncExternalStore(e.subscribe,r.useCallback(()=>t(e.getState()),[e,t]),r.useCallback(()=>t(e.getInitialState()),[e,t]));return r.useDebugValue(n),n})(t,e);return Object.assign(n,t),n},l=e=>e?o(e):o}},function(e){e.O(0,[995,400,293,456,744],function(){return e(e.s=1816)}),_N_E=e.O()}]);